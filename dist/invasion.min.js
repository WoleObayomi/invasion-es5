function Grid(t,o){this.blocks=[],this.color=o,this.blockSize=t,this.rows=Math.ceil(Constants.SCREEN_HEIGHT/this.blockSize),this.columns=Math.ceil(Constants.SCREEN_WIDTH/this.blockSize),this.gap=.5}Grid.prototype.generateBlocks=function(){for(var t=0,o=0,i=0,s=0;s<this.rows;s++){for(var r=[],h=0;h<this.columns;h++){var c={x:t,y:o,occupied:!1,index:i++};t+=this.blockSize,r.push(c)}this.blocks.push(r),o+=this.blockSize,t=0}return this.blocks},Grid.prototype.getRandomBlock=function(){var t=this.rows-1,o=this.columns-1,i=Math.ceil(Math.random()*t),s=Math.ceil(Math.random()*o);return this.blocks[i][s]},Grid.prototype.draw=function(){var t=0==this.blocks.length?this.generateBlocks():this.blocks,o=this.blockSize,i=this.gap,s=this.color;function r(t,r){for(var h=0;h<t.length;h++)r.strokeStyle=s,r.strokeRect(t[h].x+i,t[h].y+i,o,o)}return function(){for(var o=t.length,i=0;i<o;i++)r(t[i],this)}};
var invaderDrawPath=[[0,1],[1,2],[2,3],[3,4],[4,5],[5,6],[6,7],[7,0]];function Invader(i,t,s){this.x=i.x,this.y=i.y,this.size=t,this.isOffScreen=!1,this.color=s,this.generatePoints()}Invader.prototype.generatePoints=function(){this.points=[];var i={x:this.x,y:this.y},t={x:this.x+this.size/2,y:this.y-this.size/2},s={x:this.x+this.size,y:this.y},e={x:s.x-this.size/6,y:s.y+this.size/6},h={x:e.x-this.size/6,y:e.y-this.size/6},n={x:h.x-this.size/6,y:h.y+this.size/6},r={x:n.x-this.size/6,y:n.y-this.size/6},o={x:r.x-this.size/6,y:r.y+this.size/6};this.points.push(i,t,s,e,h,n,r,o)},Invader.prototype.update=function(){this.y-=.5,this.y<0?this.isOffScreen=!0:this.generatePoints()},Invader.prototype.draw=function(){var i=this.color,t=this.points.length>0?this.points:this.generatePoints();return function(){for(var s=function(s){var e=s[0],h=s[1];this.beginPath(),this.strokeStyle=i,this.moveTo(t[e].x,t[e].y),this.lineTo(t[h].x,t[h].y),this.closePath(),this.stroke()}.bind(this),e=0;e<invaderDrawPath.length;e++)s(invaderDrawPath[e])}};
var loop=function(n){(window.webkitRequestAnimationFrame||window.requestAnimationFrame||window.mozRequestAnimationFrame)(n)},Constants={SCREEN_HEIGHT:window.screen.height,SCREEN_WIDTH:window.screen.width},root=document.getElementById("root"),canvas=document.createElement("canvas");canvas.height=Constants.SCREEN_HEIGHT,canvas.width=Constants.SCREEN_WIDTH;var ctx=canvas.getContext("2d");function Invasion(n,t,i,e,a){this.grid=new Grid(e,a),this.grid.generateBlocks(),this.invaders=[],this.invaderSize=t,this.invaderCount=n,this.invaderColor=i,this.createInvaders()}root.appendChild(canvas),document.addEventListener("resize",function(){Constants={SCREEN_HEIGHT:window.screen.height,SCREEN_WIDTH:window.screen.width}}),Invasion.prototype.clear=function(){ctx.clearRect(0,0,Constants.SCREEN_WIDTH,Constants.SCREEN_HEIGHT)},Invasion.prototype.createInvaders=function(){for(var n=0;n<this.invaderCount;n++){var t=this.grid.getRandomBlock(),i=new Invader(t,this.invaderSize,this.invaderColor);this.invaders.push(i)}},Invasion.prototype.createInvader=function(){var n=this.grid.getRandomBlock(),t=new Invader({x:n.x,y:Constants.SCREEN_HEIGHT},this.invaderSize,this.invaderColor);this.invaders.push(t)},Invasion.prototype.drawGrid=function(){this.grid.draw().apply(ctx)},Invasion.prototype.drawInvaders=function(){for(var n=0;n<this.invaders.length;n++){this.invaders[n].draw().apply(ctx)}},Invasion.prototype.updateInvaders=function(){for(var n=0;n<this.invaders.length;n++)this.invaders[n].isOffScreen?(this.invaders.splice(n,1),this.createInvader()):this.invaders[n].update()},Invasion.prototype.draw=function(){this.clear(),this.drawGrid(),this.updateInvaders(),this.drawInvaders(),loop(function(){this.draw()}.bind(this))},window.Invasion=Invasion;